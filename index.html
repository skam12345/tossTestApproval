<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="utf-8" />
<link rel="icon" href="https://static.toss.im/icons/png/4x/icon-toss-logo.png" />
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>토스페이먼츠 샘플 프로젝트</title>
</head>
<script>
    window.onload = async () => {
        const urlParams = new URLSearchParams(window.location.search);
        const paymentKey = urlParams.get('paymentKey');
        const orderId = urlParams.get('orderId');
        const amount = urlParams.get('amount');

        console.log('paymentKey', paymentKey);
        console.log('orderId', orderId);        
        console.log('amount', amount);
        
        let secretKey = btoa('test_gsk_docs_OaPz8L5KdmQXkzRz3y47BMw6:');
        console.log('secretKey', secretKey);
        
        const response = await fetch('https://api.tosspayments.com/v1/payments/confirm', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'Authorization': 'Basic ' + secretKey,
          },
          body: JSON.stringify({
            'paymentKey': paymentKey,
            'orderId': orderId,
            'amount': amount,
          }),
        });

        if (response.ok) {
          const data = await response.json();
          console.log('Payment confirmed:', data);
          
          for (const [key, value] of Object.entries(data)) {
            if(typeof value === 'object' && value !== null && !Array.isArray(value)) {
              for(const [subKey, subValue] of Object.entries(value)) {
                console.log(`Setting ${key}.${subKey} to ${subValue}`);
                const subInput = document.querySelector(`input[name="${key}.${subKey}"]`);
                if(subInput) {
                  subInput.value = subValue;
                }
              }
            }
            const input = document.querySelector(`input[name="${key}"]`);
            if(input) {
              input.value = value;
            }
          }
        }else {
           const error = await response.json();
            console.error('Error confirming payment:', error);
        }
    }

    /**
{
  "mId": "tosspayments",
  "lastTransactionKey": "9C62B18EEF0DE3EB7F4422EB6D14BC6E",
  "paymentKey": "5EnNZRJGvaBX7zk2yd8ydw26XvwXkLrx9POLqKQjmAw4b0e1",
  "orderId": "a4CWyWY5m89PNh7xJwhk1",
  "orderName": "토스 티셔츠 외 2건",
  "taxExemptionAmount": 0,
  "status": "DONE",
  "requestedAt": "2024-02-13T12:17:57+09:00",
  "approvedAt": "2024-02-13T12:18:14+09:00",
  "useEscrow": false,
  "cultureExpense": false,
  "card": {
    "issuerCode": "71",
    "acquirerCode": "71",
    "number": "12345678****000*",
    "installmentPlanMonths": 0,
    "isInterestFree": false,
    "interestPayer": null,
    "approveNo": "00000000",
    "useCardPoint": false,
    "cardType": "신용",
    "ownerType": "개인",
    "acquireStatus": "READY",
    "amount": 1000
  },
  "virtualAccount": null,
  "transfer": null,
  "mobilePhone": null,
  "giftCertificate": null,
  "cashReceipt": null,
  "cashReceipts": null,
  "discount": null,
  "cancels": null,
  "secret": null,
  "type": "NORMAL",
  "easyPay": {
    "provider": "토스페이",
    "amount": 0,
    "discountAmount": 0
  },
  "country": "KR",
  "failure": null,
  "isPartialCancelable": true,
  "receipt": {
    "url": "https://dashboard.tosspayments.com/receipt/redirection?transactionId=tviva20240213121757MvuS8&ref=PX"
  },
  "checkout": {
    "url": "https://api.tosspayments.com/v1/payments/5EnNZRJGvaBX7zk2yd8ydw26XvwXkLrx9POLqKQjmAw4b0e1/checkout"
  },
  "currency": "KRW",
  "totalAmount": 1000,
  "balanceAmount": 1000,
  "suppliedAmount": 909,
  "vat": 91,
  "taxFreeAmount": 0,
  "metadata": null,
  "method": "카드",
  "version": "2022-11-16"
}
*/
</script>
<body>
<div class="wrapper w-100">
<div class="flex-column align-center confirm-loading w-100 max-w-540">
  <input type="hidden" name="mId">
  <input type="hidden" name="lastTransactionKey">
  <input type="hidden" name="paymentKey">
  <input type="hidden" name="orderId">
  <input type="hidden" name="orderName">
  <input type="hidden" name="taxExemptionAmount">
  <input type="hidden" name="status">
  <input type="hidden" name="requestedAt">
  <input type="hidden" name="approvedAt">
  <input type="hidden" name="useEscrow">
  <input type="hidden" name="cultureExpense">
  <input type="hidden" name="type">
  <input type="hidden" name="country">
  <input type="hidden" name="isPartialCancelable">
  <input type="hidden" name="currency">
  <input type="hidden" name="totalAmount">
  <input type="hidden" name="balanceAmount">
  <input type="hidden" name="suppliedAmount">
  <input type="hidden" name="vat">
  <input type="hidden" name="taxFreeAmount">
  <input type="hidden" name="method">
  <input type="hidden" name="version">

  <!-- card -->
  <input type="hidden" name="card.issuerCode">
  <input type="hidden" name="card.acquirerCode">
  <input type="hidden" name="card.number">
  <input type="hidden" name="card.installmentPlanMonths">
  <input type="hidden" name="card.isInterestFree">
  <input type="hidden" name="card.interestPayer">
  <input type="hidden" name="card.approveNo">
  <input type="hidden" name="card.useCardPoint">
  <input type="hidden" name="card.cardType">
  <input type="hidden" name="card.ownerType">
  <input type="hidden" name="card.acquireStatus">
  <input type="hidden" name="card.amount">

  <!-- easyPay -->
  <input type="hidden" name="easyPay.provider">
  <input type="hidden" name="easyPay.amount">
  <input type="hidden" name="easyPay.discountAmount">

  <!-- receipt -->
  <input type="hidden" name="receipt.url">

  <!-- checkout -->
  <input type="hidden" name="checkout.url">
</div>
</div>
</body>
</html>